## Docker Setup on Linux

### Setup

This is a guide for spinning up a linux box in case the provided one does not have enough memory to support multiple containers.

First spin up a linux AMI on AWS then SSH to the box (ec2-user@ip-address, use private key). 
Run updates and install docker

```
sudo yum update -y
sudo yum install -y docker
```

Give ec2-user root permissions for docker.
Start the service and allow prod registry to be accessed via http.

```
sudo usermod -a -G docker ec2-user
sudo service docker start
sudo nano /etc/docker/daemon.json
```

```
{
    "insecure-registries" : [ "docker.conygre.com:5000" ]
}
```

```
sudo service docker stop
```

Start and stop the AWS instance itself (NOTE: ip address will change).
SSH back into the box.

Start the docker service again, install docker-compose and give user permissions.

```
sudo service docker start
sudo curl -L https://github.com/docker/compose/releases/download/1.20.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

Set environment variables (used within the docker-compose.yml and get passed into the containers).

```
export DBNAME=swift
export USERNAME=swift
//export the PASSWORD
export PORT=8087
```

Add the docker-compose.yml file. Make a directory called SQL and add the sqlscript.sql file to it.

### Spinning Up Containers

Run the below to spin up the containers. They will be placed in a default network. Remove the detached flag (-d) to see the logs generated by the containers

```
docker-compose up -d
```

See the statuses of the running containers/processes.

```
docker-compose ps
```

Save container logs for debugging.

```
docker-compose logs --no-color >& logs.txt
```

Use this to shut down containers and the default network they sit inside.

```
docker-compose down
```